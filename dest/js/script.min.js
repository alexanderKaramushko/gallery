"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){function e(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})}function s(e){return!(!e||void 0===e.length)}function r(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function o(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var e=1===n._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void a(r.promise,e)}c(r.promise,t)}else(1===n._state?c:a)(r.promise,n._value)})):n._deferreds.push(r)}function c(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==_typeof(e)||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void l((r=n,o=e,function(){r.apply(o,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){a(t,e)}var r,o}function a(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,c(t,e))},function(e){n||(n=!0,a(t,e))})}catch(e){if(n)return;n=!0,a(t,e)}}var t=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,t,n)),n},i.prototype.finally=e,i.all=function(t){return new i(function(r,o){function i(t,e){try{if(e&&("object"==_typeof(e)||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){i(t,e)},o)}c[t]=e,0==--a&&r(c)}catch(e){o(e)}}if(!s(t))return o(new TypeError("Promise.all accepts an array"));var c=Array.prototype.slice.call(t);if(0===c.length)return r([]);for(var a=c.length,e=0;c.length>e;e++)i(e,c[e])})},i.resolve=function(t){return t&&"object"==_typeof(t)&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(o){return new i(function(e,t){if(!s(o))return t(new TypeError("Promise.race accepts an array"));for(var n=0,r=o.length;n<r;n++)i.resolve(o[n]).then(e,t)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},i._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in n?n.Promise.prototype.finally||(n.Promise.prototype.finally=e):n.Promise=i});var objectFitImages=function(){function r(e,t,n){var r=function(e,t){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+e+"' height='"+t+"'%3E%3C/svg%3E"}(t||1,n||0);p.call(e,"src")!==r&&g.call(e,"src",r)}function o(e,t){e.naturalWidth?t(e):setTimeout(o,100,e,t)}function i(t){var e=function(e){for(var t,n=getComputedStyle(e).fontFamily,r={};null!==(t=s.exec(n));)r[t[1]]=t[2];return r}(t),n=t[a];if(e["object-fit"]=e["object-fit"]||"fill",!n.img){if("fill"===e["object-fit"])return;if(!n.skipTest&&u&&!e["object-position"])return}if(!n.img){n.img=new Image(t.width,t.height),n.img.srcset=p.call(t,"data-ofi-srcset")||t.srcset,n.img.src=p.call(t,"data-ofi-src")||t.src,g.call(t,"data-ofi-src",t.src),t.srcset&&g.call(t,"data-ofi-srcset",t.srcset),r(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{!function(n){var t={get:function(e){return n[a].img[e||"src"]},set:function(e,t){return n[a].img[t||"src"]=e,g.call(n,"data-ofi-"+t,e),i(n),e}};Object.defineProperty(n,"src",t),Object.defineProperty(n,"currentSrc",{get:function(){return t.get("currentSrc")}}),Object.defineProperty(n,"srcset",{get:function(){return t.get("srcset")},set:function(e){return t.set(e,"srcset")}})}(t)}catch(t){window.console&&console.warn("https://bit.ly/ofi-old-browser")}}(function(e){if(e.srcset&&!d&&window.picturefill){var t=window.picturefill._;e[t.ns]&&e[t.ns].evaled||t.fillImg(e,{reselect:!0}),e[t.ns].curSrc||(e[t.ns].supported=!1,t.fillImg(e,{reselect:!0})),e.currentSrc=e[t.ns].curSrc||e.src}})(n.img),t.style.backgroundImage='url("'+(n.img.currentSrc||n.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=e["object-position"]||"center",t.style.backgroundRepeat="no-repeat",t.style.backgroundOrigin="content-box",/scale-down/.test(e["object-fit"])?o(n.img,function(){n.img.naturalWidth>t.width||n.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"}):t.style.backgroundSize=e["object-fit"].replace("none","auto").replace("fill","100% 100%"),o(n.img,function(e){r(t,e.naturalWidth,e.naturalHeight)})}function c(e,t){var n=!m&&!e;if(t=t||{},e=e||"img",l&&!t.skipTest||!f)return!1;"img"===e?e=document.getElementsByTagName("img"):"string"==typeof e?e=document.querySelectorAll(e):"length"in e||(e=[e]);for(var r=0;r<e.length;r++)e[r][a]=e[r][a]||{skipTest:t.skipTest},i(e[r]);n&&(document.body.addEventListener("load",function(e){"IMG"===e.target.tagName&&c(e.target,{skipTest:t.skipTest})},!0),m=!0,e="img"),t.watchMQ&&window.addEventListener("resize",c.bind(null,e,{skipTest:t.skipTest}))}var a="bfred-it:object-fit-images",s=/(object-fit|object-position)\s*:\s*([-.\w\s%]+)/g,e="undefined"==typeof Image?{style:{"object-position":1}}:new Image,u="object-fit"in e.style,l="object-position"in e.style,f="background-size"in e.style,d="string"==typeof e.currentSrc,p=e.getAttribute,g=e.setAttribute,m=!1;return c.supportsObjectFit=u,(c.supportsObjectPosition=l)||(HTMLImageElement.prototype.getAttribute=function(e){return p.call(n(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,t){return g.call(n(this,e),e,String(t))}),c;function n(e,t){return e[a]&&e[a].img&&("src"===t||"srcset"===t)?e[a].img:e}}();function get(r,o){return new Promise(function(e,t){var n=new XMLHttpRequest;n.open("GET",r,!0),n.responseType=o,n.send(),n.addEventListener("load",function(){200!=n.status?t():e(n.response)})})}function post(e,t){var n=new XMLHttpRequest;n.open("POST",e,!1),n.setRequestHeader("Content-Type","application/json"),n.send(t)}function createImg(e){var t=document.createElement("img"),n=window.URL||window.webkitURL;t.classList.add("gallery__img"),t.src=n.createObjectURL(e),document.querySelector(".gallery__list").append(t),objectFitImages()}function udpateAfterReload(){get("http://localhost:3000/images","application/json").then(function(e){JSON.parse(e).forEach(function(e){get(e.url,"blob").then(function(e){createImg(e)})})})}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}})}),document.addEventListener("DOMContentLoaded",udpateAfterReload),document.querySelector(".gallery__add").onclick=function(e){e.preventDefault();var t=document.querySelector(".gallery__url").value;t?get(t,"blob").then(function(e){return createImg(e),JSON.stringify({url:t})}).then(function(e){return post("http://localhost:3000/images",e)}).catch(function(e){alert("Uncorrect URL or broken link!")}):alert("No URL entered!")},document.querySelector(".gallery__load").onchange=function(e){var t=e.target.files[0];if(t.name.match(/.json/g)){var n=new FileReader;n.onload=function(e){for(var t=JSON.parse(e.target.result),n=0;n<t.images.length;n++)post("http://localhost:3000/images",JSON.stringify(t.images[n])),t.images.length},n.readAsText(t)}else alert("Choose JSON file!")};